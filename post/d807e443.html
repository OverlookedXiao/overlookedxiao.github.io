<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no"><title>Android基础之Smali语法 | XiaoJun的个人笔记</title><meta name="author" content="XiaoJun"><meta name="copyright" content="XiaoJun"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="Android基础之Smali语法:  前言: 众所周知，java是一种面向对象的编程语言，一条狗，一部手机，一片树叶都可以是对象，它就像是对现实世界的映射。 Android代码一般是用java编写的，执行java程序一般需要用到java虚"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="https://www.overlooked.top/post/d807e443.html"><link rel="preconnect" href="//cdn.jsdelivr.net"><link rel="preconnect" href="//busuanzi.ibruce.info"><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://lf26-cdn-tos.bytecdntp.com/cdn/expire-1-M/font-awesome/6.0.0/css/all.min.css" media="print" onload='this.media="all"'><link rel="stylesheet" href="https://lib.baomitu.com/fancyapps-ui/4.0.31/fancybox.min.css" media="print" onload='this.media="all"'><script>const GLOBAL_CONFIG={root:"/",algolia:void 0,localSearch:{path:"/search.json",preload:!1,languages:{hits_empty:"找不到您查询的内容：${query}"}},translate:void 0,noticeOutdate:{limitDay:730,position:"top",messagePrev:"本文最后更新于",messageNext:"天前，其中的信息可能已经不够准确，请您酌情参考！"},highlight:{plugin:"prismjs",highlightCopy:!0,highlightLang:!0,highlightHeightLimit:500},copy:{success:"复制成功",error:"复制错误",noSupport:"浏览器不支持"},relativeDate:{homepage:!1,post:!1},runtime:"",date_suffix:{just:"刚刚",min:"分钟前",hour:"小时前",day:"天前",month:"个月前"},copyright:void 0,lightbox:"fancybox",Snackbar:void 0,source:{justifiedGallery:{js:"https://lib.baomitu.com/flickr-justified-gallery/2.1.2/fjGallery.min.js",css:"https://lib.baomitu.com/flickr-justified-gallery/2.1.2/fjGallery.min.css"}},isPhotoFigcaption:!1,islazyload:!1,isAnchor:!1}</script><script id="config-diff">var GLOBAL_CONFIG_SITE={title:"Android基础之Smali语法",isPost:!0,isHome:!1,isHighlightShrink:!1,isToc:!0,postUpdate:"2022-11-19 13:07:42"}</script><noscript><style type="text/css">#nav{opacity:1}.justified-gallery img{opacity:1}#post-meta time,#recent-posts time{display:inline!important}</style></noscript><script>(e=>{e.saveToLocal={set:function(e,t,o){if(0===o)return;const n=864e5*o,a={value:t,expiry:(new Date).getTime()+n};localStorage.setItem(e,JSON.stringify(a))},get:function(e){const t=localStorage.getItem(e);if(!t)return;const o=JSON.parse(t);if(!((new Date).getTime()>o.expiry))return o.value;localStorage.removeItem(e)}},e.getScript=e=>new Promise(((t,o)=>{const n=document.createElement("script");n.src=e,n.async=!0,n.onerror=o,n.onload=n.onreadystatechange=function(){const e=this.readyState;e&&"loaded"!==e&&"complete"!==e||(n.onload=n.onreadystatechange=null,t())},document.head.appendChild(n)})),e.activateDarkMode=function(){document.documentElement.setAttribute("data-theme","dark"),null!==document.querySelector('meta[name="theme-color"]')&&document.querySelector('meta[name="theme-color"]').setAttribute("content","#0d0d0d")},e.activateLightMode=function(){document.documentElement.setAttribute("data-theme","light"),null!==document.querySelector('meta[name="theme-color"]')&&document.querySelector('meta[name="theme-color"]').setAttribute("content","#ffffff")};const t=saveToLocal.get("theme");"dark"===t?activateDarkMode():"light"===t&&activateLightMode();const o=saveToLocal.get("aside-status");void 0!==o&&("hide"===o?document.documentElement.classList.add("hide-aside"):document.documentElement.classList.remove("hide-aside"));/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)&&document.documentElement.classList.add("apple")})(window)</script><link rel="stylesheet" href="/css/marge.css"><meta name="generator" content="Hexo 6.3.0"></head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="/img/favicon.png" onerror='onerror=null,src="/img/friend_404.gif"' alt="avatar"></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">18</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">13</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">6</div></a></div><hr><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 文章分类</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友情链接</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image:url('https://image.overlooked.top/img/cover/4.png')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">XiaoJun的个人笔记</a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 文章分类</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友情链接</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">Android基础之Smali语法</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2022-11-18T04:23:56.000Z" title="发表于 2022-11-18 12:23:56">2022-11-18</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2022-11-19T05:07:42.000Z" title="更新于 2022-11-19 13:07:42">2022-11-19</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/Android/">Android</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">3.5k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>12分钟</span></span><span class="post-meta-separator">|</span><span data-flag-title="Android基础之Smali语法"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="twikoo_visitors"><i class="fa-solid fa-spinner fa-spin"></i></span></span><span class="post-meta-separator">|</span><span class="post-meta-commentcount"><i class="far fa-comments fa-fw post-meta-icon"></i><span class="post-meta-label">评论数:</span><a href="/post/d807e443.html#post-comment"><span id="twikoo-count"><i class="fa-solid fa-spinner fa-spin"></i></span></a></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h2 id="Android基础之Smali语法">Android基础之Smali语法</h2><hr><h3 id="前言">前言</h3><p>众所周知，java是一种面向对象的编程语言，一条狗，一部手机，一片树叶都可以是对象，它就像是对现实世界的映射。</p><p>Android代码一般是用java编写的，执行java程序一般需要用到<code>java虚拟机</code>，在Android平台上也不例外，但是出于性能上的考虑，并没有使用标准的JVM，而是使用专门的<code>Android虚拟机</code>（使用 C 或 C++ 代码实现，5.0以下为<code>Dalvik</code>，5.0以上为<code>ART</code>）。</p><p>Android虚拟机的可执行文件并不是普通的class文件，而是重新整合打包后生成的dex文件。dex文件<code>反编译</code>之后就是Smali代码，Smali实质上就是java字节码，所以说，Smali语言是Android虚拟机的<code>反汇编语言</code>。</p><h3 id="为什么要了解Smali">为什么要了解Smali</h3><ol><li>修改APK运行逻辑： 通过修改Smali代码，再重新编译打包成新的APK，可实现修改APP的运行逻辑，甚至逆向破解。</li><li>动态调试APK： 通常静态分析APK是不够的，如果需要彻底分析APK的执行逻辑，需要通过动态调试(常使用smalidea)来进行。</li><li>加强理解能力： Smali是介于Android虚拟机与java之间的语言，了解它有助于我们更好的理解代码的运行过程，从而写出性能更优的程序。</li></ol><h3 id="Smali简单入门">Smali简单入门</h3><p>举个例子，最简单的java代码：</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Hello World"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>把它写成Smali大概就是：</p><pre class="line-numbers language-smali" data-language="smali"><code class="language-smali"><span class="token comment"># 获取System类中的out字段，存到v0中</span>
sget-object <span class="token register variable">v0</span><span class="token punctuation">,</span> <span class="token class-name"><span class="token builtin">L</span><span class="token namespace">java<span class="token punctuation">/</span>lang<span class="token punctuation">/</span></span><span class="token class-name">System</span></span><span class="token punctuation">;</span><span class="token operator">-></span><span class="token field variable">out</span><span class="token punctuation">:</span><span class="token class-name"><span class="token builtin">L</span><span class="token namespace">java<span class="token punctuation">/</span>io<span class="token punctuation">/</span></span><span class="token class-name">PrintStream</span></span><span class="token punctuation">;</span>
<span class="token comment"># 把"Hello World"存到v1中</span>
const-string <span class="token register variable">v1</span><span class="token punctuation">,</span> <span class="token string">"Hello World"</span>
<span class="token comment"># 调用虚方法println，传入参数v0, v1</span>
<span class="token comment"># 相当于v0.println(v1)</span>
invoke-virtual <span class="token punctuation">&#123;</span><span class="token register variable">v0</span><span class="token punctuation">,</span> <span class="token register variable">v1</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token class-name"><span class="token builtin">L</span><span class="token namespace">java<span class="token punctuation">/</span>io<span class="token punctuation">/</span></span><span class="token class-name">PrintStream</span></span><span class="token punctuation">;</span><span class="token operator">-></span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name"><span class="token builtin">L</span><span class="token namespace">java<span class="token punctuation">/</span>lang<span class="token punctuation">/</span></span><span class="token class-name">String</span></span><span class="token punctuation">;</span><span class="token punctuation">)</span><span class="token builtin">V</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>可以看到一句简单的Java代码会被分解成几句较为复杂的Smali代码，你可能会问为什么要搞这么复杂？因为Java是给人看的，Smali是给虚拟机执行的。</p><p>就像你叫一个人走过来，正常人他可以直接走过来，但如果是机器人，你就得告诉它先跨左脚，角度多少，然后右脚抬起后脚跟，重心往前…最后走完多少步停下，如果遇到转弯或者障碍的话就更复杂了。</p><p>没错，教机器做事就是得这么麻烦，所以同理Smali也是在和机器对话，因此比较麻烦。</p><h3 id="Smali基本结构">Smali基本结构</h3><p>你可以在一个xxx.java中定义<code>多个类</code>（包括<code>匿名内部类</code>），但一个smali文件只能定义<code>一个类</code>，简单来看，其一般格式是：</p><pre class="line-numbers language-smali" data-language="smali"><code class="language-smali"><span class="token keyword">.class</span> 修饰符 类名
<span class="token keyword">.super</span> 父类的类名
<span class="token keyword">.source</span> 源文件名

<span class="token comment"># 接口</span>
<span class="token keyword">.implements</span> 接口类名

<span class="token comment"># 注解</span>
<span class="token keyword">.annotation</span> xxxxxxx
    xxxxxx
<span class="token keyword">.end</span> <span class="token keyword">annotation</span>

<span class="token comment"># 字段</span>
<span class="token keyword">.field</span> 描述符 字段名<span class="token punctuation">:</span>字段类型

<span class="token comment"># 方法</span>
<span class="token keyword">.method</span> 描述符 方法名<span class="token punctuation">(</span>参数类型<span class="token punctuation">)</span>返回类型
    方法代码<span class="token operator">..</span>.
<span class="token keyword">.end</span> <span class="token keyword">method</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ol><li>其中<code>修饰符</code>就是public、private、protected、static、final等，和Java中的差不多，另外对于类还有<code>interface</code>和<code>enum</code>来表示这个类是一个<code>接口</code>或者<code>枚举类</code>。</li><li>Smali中的<code>类名</code>都是<code>L包名路径/类名;</code>，例如Android中的TextView类，它的包名是android.widget，如果你要在Smali中表示这个类，就要写成<code>Landroid/widget/TextView;</code>。</li><li><code>源文件名</code>就是编译这个类的java文件名，如<code>Main.java</code>，仅用于debug，因此删了也没影响。</li><li><code>接口</code>可以有0个或者多个，表示这个类实现了哪些接口，例如：</li></ol><pre class="line-numbers language-smali" data-language="smali"><code class="language-smali"><span class="token keyword">.implements</span> <span class="token class-name"><span class="token builtin">L</span><span class="token namespace">android<span class="token punctuation">/</span>view<span class="token punctuation">/</span></span><span class="token class-name">View$OnClickListener</span></span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ol start="5"><li><code>注解</code>可以有0个或者多个，注解的话就是Java代码中@XXX之类的代码，例如比较常见的<code>@Override</code>、<code>@Nullable</code>、<code>@NonNull</code>等，其实不了解注解也没关系，毕竟一般情况也用不上，只要在Smali中看到<code>annotation</code>时知道它是注解就行了；</li><li><code>字段</code>可以有0个或者多个，其语法为<code>.field 描述符 字段名:字段类型</code>，例如Java代码中定义了text字段：</li></ol><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token class-name">String</span> text<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>其对应的Smali代码为：</p><pre class="line-numbers language-smali" data-language="smali"><code class="language-smali"><span class="token keyword">.field</span> <span class="token keyword">public</span> <span class="token field variable">text</span><span class="token punctuation">:</span><span class="token class-name"><span class="token builtin">L</span><span class="token namespace">java<span class="token punctuation">/</span>lang<span class="token punctuation">/</span></span><span class="token class-name">String</span></span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>当一个字段是<code>static</code>和<code>final</code>（即静态常量）且它的类型是<code>基本类型</code>时，可以直接为它<code>赋值</code>：</p><pre class="line-numbers language-smali" data-language="smali"><code class="language-smali"><span class="token keyword">.field</span> <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token field variable">ID</span><span class="token punctuation">:</span><span class="token builtin">I</span> <span class="token operator">=</span> <span class="token number">0x7f0a0001</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>如果定义的字段<code>包含注解</code>，那么语法是：</p><pre class="line-numbers language-smali" data-language="smali"><code class="language-smali"><span class="token keyword">.field</span> XXXXX
    <span class="token punctuation">&#123;</span>注解列表<span class="token punctuation">&#125;</span>
<span class="token keyword">.end</span> <span class="token keyword">field</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><ol start="7"><li><code>方法</code>可以有0个或者多个，Smali中定义方法的语法是：</li></ol><pre class="line-numbers language-smali" data-language="smali"><code class="language-smali"><span class="token keyword">.method</span> 描述符 方法名<span class="token punctuation">(</span>参数类型<span class="token punctuation">)</span>返回类型
    方法代码<span class="token operator">..</span>.
<span class="token keyword">.end</span> <span class="token keyword">method</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>其中<code>参数类型</code>可以有<code>0个或多个</code>，<code>返回类型</code>必须是<code>一个</code>，当要表达多个参数类型时，只需简单地将它们连接到一起，例如 <code>(int, int, String)</code> 表示为 <code>(IILjava/lang/String;)</code></p><blockquote><p>方法代码是最复杂的部分，将在后面的文章中慢慢介绍</p></blockquote><h3 id="Smali变量类型">Smali变量类型</h3><p>在Java中类型分为<code>基本类型</code>和<code>引用类型</code><br><code>基本类型</code>共有9个，它们在Smali中的对应关系是：</p><table><thead><tr><th style="text-align:center">Java</th><th style="text-align:center">Smali</th></tr></thead><tbody><tr><td style="text-align:center">void</td><td style="text-align:center">V</td></tr><tr><td style="text-align:center">boolean</td><td style="text-align:center">Z</td></tr><tr><td style="text-align:center">byte</td><td style="text-align:center">B</td></tr><tr><td style="text-align:center">short</td><td style="text-align:center">S</td></tr><tr><td style="text-align:center">char</td><td style="text-align:center">C</td></tr><tr><td style="text-align:center">int</td><td style="text-align:center">I</td></tr><tr><td style="text-align:center">long</td><td style="text-align:center">J</td></tr><tr><td style="text-align:center">float</td><td style="text-align:center">F</td></tr><tr><td style="text-align:center">double</td><td style="text-align:center">D</td></tr></tbody></table><blockquote><p>其中除了<code>boolean对应Z</code>，<code>long对应J</code>，其它都是对应<code>首字母大写</code>，还是很好记的</p></blockquote><p>而<code>引用类型</code>，在Smali中都是用<code>L包名路径/类名;</code>表示，例如Android中的TextView类，它的包名是android.widget，如果你要在Smali中表示这个类，就要写成<code>Landroid/widget/TextView;</code></p><p>Smali中通过在类型前面加<code>[</code>来表示该类型的数组，例如<code>[I</code>表示<code>int[]</code>，<code>[Ljava/lang/String;</code>表示<code>String[]</code>，如果要表示多维数组，只需要<code>增加[的数量</code>，例如<code>[[I</code>表示二维数组<code>int[][]</code></p><h3 id="调用方法">调用方法</h3><p>Smali中必须以非常详细的形式指定要调用的方法，包括类名、方法名、参数类型和返回类型，其具体形式是：<code>类名-&gt;方法名(参数类型)返回类型</code><br>例如：</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Hello world"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>其中out是System的一个<code>静态字段</code>，它的<code>类型</code>是PrintStream，println是PrintStream中的<code>一个方法</code>，其<code>返回类型</code>为void，因此其调用方法为：</p><pre class="line-numbers language-smali" data-language="smali"><code class="language-smali">invoke-virtual <span class="token punctuation">&#123;</span><span class="token register variable">v0</span><span class="token punctuation">,</span> <span class="token register variable">v1</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token class-name"><span class="token builtin">L</span><span class="token namespace">java<span class="token punctuation">/</span>io<span class="token punctuation">/</span></span><span class="token class-name">PrintStream</span></span><span class="token punctuation">;</span><span class="token operator">-></span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name"><span class="token builtin">L</span><span class="token namespace">java<span class="token punctuation">/</span>lang<span class="token punctuation">/</span></span><span class="token class-name">String</span></span><span class="token punctuation">;</span><span class="token punctuation">)</span><span class="token builtin">V</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="引用字段">引用字段</h3><p>和调用方法类似，在引用一个字段时，同样需要用非常详细的形式指定字段，其具体形式是：<code>类名-&gt;字段名:字段类名</code><br>例如：</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Hello world"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>在调用println方法前需要现将System类的字段out放到寄存器v0中，也就是下面这句代码：</p><pre class="line-numbers language-smali" data-language="smali"><code class="language-smali">sget-object <span class="token register variable">v0</span><span class="token punctuation">,</span> <span class="token class-name"><span class="token builtin">L</span><span class="token namespace">java<span class="token punctuation">/</span>lang<span class="token punctuation">/</span></span><span class="token class-name">System</span></span><span class="token punctuation">;</span><span class="token operator">-></span><span class="token field variable">out</span><span class="token punctuation">:</span><span class="token class-name"><span class="token builtin">L</span><span class="token namespace">java<span class="token punctuation">/</span>io<span class="token punctuation">/</span></span><span class="token class-name">PrintStream</span></span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>后面那部分正是字段out的完整表达形式</p><h3 id="寄存器">寄存器</h3><h4 id="普通寄存器">普通寄存器</h4><p>如果你有看过一些Smali代码，你肯定会注意到有很多<code>v0</code>、<code>v1</code>、<code>v2</code>、<code>p0</code>、<code>p1</code>、<code>p2</code>之类的标识符，这些都代表了寄存器。<br>那么寄存器是什么？你可以把它认为是<code>变量</code>，或者是<code>暂时存放东西</code>的地方。</p><p>例如：<br>有一个静态方法<code>static void abc(String s)</code>，如果你要在Java方法中调用这个方法，直接输入<code>abc(&quot;Hello&quot;);</code>就行了。<br>而在Smali中，你不能直接把字符串参数传递给方法，你需要一个寄存器（比如<code>v0</code>），先把<code>&quot;Hello&quot;</code>放到<code>v0</code>中，然后再<code>调用abc方法</code>，并告诉它你需要的参数在<code>v0</code>里面：</p><pre class="line-numbers language-smali" data-language="smali"><code class="language-smali"><span class="token comment"># 定义一个字符串常量"Hello"放到v0中</span>
const-string <span class="token register variable">v0</span><span class="token punctuation">,</span> <span class="token string">"Hello"</span>
<span class="token comment"># 调用abc方法，需要的参数放在v0中</span>
invoke-static <span class="token punctuation">&#123;</span><span class="token register variable">v0</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token class-name"><span class="token builtin">L</span><span class="token class-name">XX</span></span><span class="token punctuation">;</span><span class="token operator">-></span><span class="token function">abc</span><span class="token punctuation">(</span><span class="token class-name"><span class="token builtin">L</span><span class="token namespace">java<span class="token punctuation">/</span>lang<span class="token punctuation">/</span></span><span class="token class-name">String</span></span><span class="token punctuation">;</span><span class="token punctuation">)</span><span class="token builtin">V</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>另外寄存器<code>v0</code>、<code>v1</code>、<code>v2</code>后面的数字也不是随便写的，需要在方法的开头用<code>.registers N</code>来指定<code>寄存器的数量</code>，然后才可以使用寄存器<code>v0到v(N-1)</code>。</p><h4 id="参数寄存器">参数寄存器</h4><p>上面说的都是普通寄存器<code>vN</code>，另外Smali还特意定义了一种参数寄存器<code>pN</code>，用于存放这个方法传入的参数的值。<br>如果一个方法有n个寄存器，有m个参数，那么<code>n必须大于等于m</code>，并且n个寄存器的后面m个是参数寄存器。</p><p>举个例子：<br>某个静态方法<code>static void abc(int, int, int)</code>，它一共有3个参数，如果它一共有5个寄存器（通过<code>.registers N</code>定义，<code>N不小于3</code>）：</p><table><thead><tr><th style="text-align:center">普通寄存器</th><th style="text-align:center">对应参数寄存器</th></tr></thead><tbody><tr><td style="text-align:center">v0</td><td style="text-align:center"></td></tr><tr><td style="text-align:center">v1</td><td style="text-align:center"></td></tr><tr><td style="text-align:center">v2</td><td style="text-align:center">p0</td></tr><tr><td style="text-align:center">v3</td><td style="text-align:center">p1</td></tr><tr><td style="text-align:center">v4</td><td style="text-align:center">p2</td></tr></tbody></table><p>当调用<code>abc(11, 22, 33)</code>时，<code>p0</code>中的值初始化为<code>11</code>，<code>p1</code>中的值初始化为<code>22</code>，<code>p2</code>中的值初始化为<code>33</code>，<code>v0和v1不会被初始化</code>：</p><table><thead><tr><th style="text-align:center">普通寄存器</th><th style="text-align:center">对应参数寄存器</th><th style="text-align:center">初始化</th></tr></thead><tbody><tr><td style="text-align:center">v0</td><td style="text-align:center"></td><td style="text-align:center"></td></tr><tr><td style="text-align:center">v1</td><td style="text-align:center"></td><td style="text-align:center"></td></tr><tr><td style="text-align:center">v2</td><td style="text-align:center">p0</td><td style="text-align:center">11</td></tr><tr><td style="text-align:center">v3</td><td style="text-align:center">p1</td><td style="text-align:center">22</td></tr><tr><td style="text-align:center">v4</td><td style="text-align:center">p2</td><td style="text-align:center">33</td></tr></tbody></table><p>当把寄存器数量改成6(<code>.registers 6</code>)，寄存器就会变成下表所示：</p><table><thead><tr><th style="text-align:center">普通寄存器</th><th style="text-align:center">对应参数寄存器</th><th style="text-align:center">初始化</th></tr></thead><tbody><tr><td style="text-align:center">v0</td><td style="text-align:center"></td><td style="text-align:center"></td></tr><tr><td style="text-align:center">v1</td><td style="text-align:center"></td><td style="text-align:center"></td></tr><tr><td style="text-align:center">v2</td><td style="text-align:center"></td><td style="text-align:center"></td></tr><tr><td style="text-align:center">v3</td><td style="text-align:center">p0</td><td style="text-align:center">11</td></tr><tr><td style="text-align:center">v4</td><td style="text-align:center">p1</td><td style="text-align:center">22</td></tr><tr><td style="text-align:center">v5</td><td style="text-align:center">p2</td><td style="text-align:center">33</td></tr></tbody></table><p>思考一下，如果不使用参数寄存器，代码中全部用<code>vN</code>，那么改变寄存器数量后，你还得改多少代码？</p><h4 id="隐藏参数">隐藏参数</h4><p>对于<code>非静态方法</code>，它的参数寄存器数量比实际参数<code>多了一个</code>，<code>p0</code>会固定用于表示当前类实例（Java中的<code>this</code>），从p1开始才是真正的参数，我们可以通过<code>Java2Smali</code>工具来验证一下，Java代码如下：</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Main</span><span class="token punctuation">&#123;</span>

  <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">test1</span><span class="token punctuation">(</span><span class="token class-name">String</span> s<span class="token punctuation">,</span> <span class="token keyword">int</span> i<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>

  <span class="token keyword">void</span> <span class="token function">test2</span><span class="token punctuation">(</span><span class="token class-name">String</span> s<span class="token punctuation">,</span> <span class="token keyword">int</span> i<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>

<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><code>test1()</code>和<code>test2()</code>的唯一区别就是一个是<code>静态</code>一个是<code>非静态</code></p><p><code>test1()</code>的Smali代码如下：</p><pre class="line-numbers language-smali" data-language="smali"><code class="language-smali"><span class="token keyword">.method</span> <span class="token keyword">static</span> <span class="token function">test1</span><span class="token punctuation">(</span><span class="token class-name"><span class="token builtin">L</span><span class="token namespace">java<span class="token punctuation">/</span>lang<span class="token punctuation">/</span></span><span class="token class-name">String</span></span><span class="token punctuation">;</span><span class="token builtin">I</span><span class="token punctuation">)</span><span class="token builtin">V</span>
  <span class="token keyword">.registers</span> <span class="token number">3</span>

  <span class="token keyword">.prologue</span>
  <span class="token keyword">.line</span> <span class="token number">4</span>
  sget-object <span class="token register variable">v0</span><span class="token punctuation">,</span> <span class="token class-name"><span class="token builtin">L</span><span class="token namespace">java<span class="token punctuation">/</span>lang<span class="token punctuation">/</span></span><span class="token class-name">System</span></span><span class="token punctuation">;</span><span class="token operator">-></span><span class="token field variable">out</span><span class="token punctuation">:</span><span class="token class-name"><span class="token builtin">L</span><span class="token namespace">java<span class="token punctuation">/</span>io<span class="token punctuation">/</span></span><span class="token class-name">PrintStream</span></span><span class="token punctuation">;</span>

  invoke-virtual <span class="token punctuation">&#123;</span><span class="token register variable">v0</span><span class="token punctuation">,</span> <span class="token register variable">p0</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token class-name"><span class="token builtin">L</span><span class="token namespace">java<span class="token punctuation">/</span>io<span class="token punctuation">/</span></span><span class="token class-name">PrintStream</span></span><span class="token punctuation">;</span><span class="token operator">-></span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name"><span class="token builtin">L</span><span class="token namespace">java<span class="token punctuation">/</span>lang<span class="token punctuation">/</span></span><span class="token class-name">String</span></span><span class="token punctuation">;</span><span class="token punctuation">)</span><span class="token builtin">V</span>

  <span class="token keyword">.line</span> <span class="token number">5</span>
  sget-object <span class="token register variable">v0</span><span class="token punctuation">,</span> <span class="token class-name"><span class="token builtin">L</span><span class="token namespace">java<span class="token punctuation">/</span>lang<span class="token punctuation">/</span></span><span class="token class-name">System</span></span><span class="token punctuation">;</span><span class="token operator">-></span><span class="token field variable">out</span><span class="token punctuation">:</span><span class="token class-name"><span class="token builtin">L</span><span class="token namespace">java<span class="token punctuation">/</span>io<span class="token punctuation">/</span></span><span class="token class-name">PrintStream</span></span><span class="token punctuation">;</span>

  invoke-virtual <span class="token punctuation">&#123;</span><span class="token register variable">v0</span><span class="token punctuation">,</span> <span class="token register variable">p1</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token class-name"><span class="token builtin">L</span><span class="token namespace">java<span class="token punctuation">/</span>io<span class="token punctuation">/</span></span><span class="token class-name">PrintStream</span></span><span class="token punctuation">;</span><span class="token operator">-></span><span class="token function">println</span><span class="token punctuation">(</span><span class="token builtin">I</span><span class="token punctuation">)</span><span class="token builtin">V</span>

  <span class="token keyword">.line</span> <span class="token number">6</span>
  return-void
<span class="token keyword">.end</span> <span class="token keyword">method</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><code>test2()</code>的Smali代码如下：</p><pre class="line-numbers language-smali" data-language="smali"><code class="language-smali"><span class="token keyword">.method</span> <span class="token function">test2</span><span class="token punctuation">(</span><span class="token class-name"><span class="token builtin">L</span><span class="token namespace">java<span class="token punctuation">/</span>lang<span class="token punctuation">/</span></span><span class="token class-name">String</span></span><span class="token punctuation">;</span><span class="token builtin">I</span><span class="token punctuation">)</span><span class="token builtin">V</span>
  <span class="token keyword">.registers</span> <span class="token number">4</span>

  <span class="token keyword">.prologue</span>
  <span class="token keyword">.line</span> <span class="token number">9</span>
  sget-object <span class="token register variable">v0</span><span class="token punctuation">,</span> <span class="token class-name"><span class="token builtin">L</span><span class="token namespace">java<span class="token punctuation">/</span>lang<span class="token punctuation">/</span></span><span class="token class-name">System</span></span><span class="token punctuation">;</span><span class="token operator">-></span><span class="token field variable">out</span><span class="token punctuation">:</span><span class="token class-name"><span class="token builtin">L</span><span class="token namespace">java<span class="token punctuation">/</span>io<span class="token punctuation">/</span></span><span class="token class-name">PrintStream</span></span><span class="token punctuation">;</span>

  invoke-virtual <span class="token punctuation">&#123;</span><span class="token register variable">v0</span><span class="token punctuation">,</span> <span class="token register variable">p1</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token class-name"><span class="token builtin">L</span><span class="token namespace">java<span class="token punctuation">/</span>io<span class="token punctuation">/</span></span><span class="token class-name">PrintStream</span></span><span class="token punctuation">;</span><span class="token operator">-></span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name"><span class="token builtin">L</span><span class="token namespace">java<span class="token punctuation">/</span>lang<span class="token punctuation">/</span></span><span class="token class-name">String</span></span><span class="token punctuation">;</span><span class="token punctuation">)</span><span class="token builtin">V</span>

  <span class="token keyword">.line</span> <span class="token number">10</span>
  sget-object <span class="token register variable">v0</span><span class="token punctuation">,</span> <span class="token class-name"><span class="token builtin">L</span><span class="token namespace">java<span class="token punctuation">/</span>lang<span class="token punctuation">/</span></span><span class="token class-name">System</span></span><span class="token punctuation">;</span><span class="token operator">-></span><span class="token field variable">out</span><span class="token punctuation">:</span><span class="token class-name"><span class="token builtin">L</span><span class="token namespace">java<span class="token punctuation">/</span>io<span class="token punctuation">/</span></span><span class="token class-name">PrintStream</span></span><span class="token punctuation">;</span>

  invoke-virtual <span class="token punctuation">&#123;</span><span class="token register variable">v0</span><span class="token punctuation">,</span> <span class="token register variable">p2</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token class-name"><span class="token builtin">L</span><span class="token namespace">java<span class="token punctuation">/</span>io<span class="token punctuation">/</span></span><span class="token class-name">PrintStream</span></span><span class="token punctuation">;</span><span class="token operator">-></span><span class="token function">println</span><span class="token punctuation">(</span><span class="token builtin">I</span><span class="token punctuation">)</span><span class="token builtin">V</span>

  <span class="token keyword">.line</span> <span class="token number">11</span>
  return-void
<span class="token keyword">.end</span> <span class="token keyword">method</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>两个方法都是依次打印出两个参数，<code>test1()</code>中打印第一个参数用的是<code>p0</code>，打印第二个参数用的是<code>p1</code>，对照之下<code>test2()</code>中则分别用的是<code>p1</code>和<code>p2</code></p><p>那<code>test2()</code>中的<code>p0</code>真的代表<code>this</code>吗？我们也可以修改代码验证下：</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Main</span><span class="token punctuation">&#123;</span>

  <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">test1</span><span class="token punctuation">(</span><span class="token class-name">String</span> s<span class="token punctuation">,</span> <span class="token keyword">int</span> i<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>

  <span class="token keyword">void</span> <span class="token function">test2</span><span class="token punctuation">(</span><span class="token class-name">String</span> s<span class="token punctuation">,</span> <span class="token keyword">int</span> i<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>

<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><code>test2()</code>的Smali代码如下：</p><pre class="line-numbers language-smali" data-language="smali"><code class="language-smali"><span class="token keyword">.method</span> <span class="token function">test2</span><span class="token punctuation">(</span><span class="token class-name"><span class="token builtin">L</span><span class="token namespace">java<span class="token punctuation">/</span>lang<span class="token punctuation">/</span></span><span class="token class-name">String</span></span><span class="token punctuation">;</span><span class="token builtin">I</span><span class="token punctuation">)</span><span class="token builtin">V</span>
  <span class="token keyword">.registers</span> <span class="token number">4</span>

  <span class="token keyword">.prologue</span>
  <span class="token keyword">.line</span> <span class="token number">9</span>
  sget-object <span class="token register variable">v0</span><span class="token punctuation">,</span> <span class="token class-name"><span class="token builtin">L</span><span class="token namespace">java<span class="token punctuation">/</span>lang<span class="token punctuation">/</span></span><span class="token class-name">System</span></span><span class="token punctuation">;</span><span class="token operator">-></span><span class="token field variable">out</span><span class="token punctuation">:</span><span class="token class-name"><span class="token builtin">L</span><span class="token namespace">java<span class="token punctuation">/</span>io<span class="token punctuation">/</span></span><span class="token class-name">PrintStream</span></span><span class="token punctuation">;</span>

  invoke-virtual <span class="token punctuation">&#123;</span><span class="token register variable">v0</span><span class="token punctuation">,</span> <span class="token register variable">p0</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token class-name"><span class="token builtin">L</span><span class="token namespace">java<span class="token punctuation">/</span>io<span class="token punctuation">/</span></span><span class="token class-name">PrintStream</span></span><span class="token punctuation">;</span><span class="token operator">-></span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name"><span class="token builtin">L</span><span class="token namespace">java<span class="token punctuation">/</span>lang<span class="token punctuation">/</span></span><span class="token class-name">Obiect</span></span><span class="token punctuation">;</span><span class="token punctuation">)</span><span class="token builtin">V</span>

  <span class="token keyword">.line</span> <span class="token number">10</span>
  return-void
<span class="token keyword">.end</span> <span class="token keyword">method</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>由此便证实了，在Smali中对于<code>非静态方法</code>，会使用<code>p0</code>指代<code>this</code>(即<code>当前对象</code>)，<code>p1</code>为方法的<code>第一个参数</code></p><p>而在<code>静态方法</code>中，<code>p0</code>为方法的<code>第一个参数</code></p><h3 id="调用方法的指令">调用方法的指令</h3><p>Smali语法中调用方法的指令一共有5条，分别是：</p><table><thead><tr><th style="text-align:center">指令名称</th><th style="text-align:center">含义</th></tr></thead><tbody><tr><td style="text-align:center">invoke-virtual</td><td style="text-align:center">调用虚方法</td></tr><tr><td style="text-align:center">invoke-direct</td><td style="text-align:center">直接调用方法</td></tr><tr><td style="text-align:center">invoke-static</td><td style="text-align:center">调用静态方法</td></tr><tr><td style="text-align:center">invoke-super</td><td style="text-align:center">调用父类方法</td></tr><tr><td style="text-align:center">invoke-interface</td><td style="text-align:center">调用接口方法</td></tr></tbody></table><p>使用语法是：<code>invoke-xxxxxx &#123;参数列表&#125;, 类名-&gt;方法名(参数类型)返回类型</code></p><p>所以当在Smali代码中看到<code>invoke开头</code>的指令，就可以直接确定这句代码用于<code>调用某个方法</code>，至于invoke-后面跟着的<code>单词</code>，取决于它要调用的<code>方法的类型</code></p><h4 id="调用虚方法">调用虚方法</h4><p>虚方法其实是<code>Java多态</code>中的一个概念，大家应该知道Java中<code>子类可以重写父类中可被继承的非final方法</code>，调用这些方法时，都需要使用<code>invoke-virtual</code>指令，才能实现多态的特性，例如下面代码：</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">Object</span> obj <span class="token operator">=</span> <span class="token string">"123"</span><span class="token punctuation">;</span>
obj<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token string">"456"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>这边调用equals方法的Smali代码为：</p><pre class="line-numbers language-smali" data-language="smali"><code class="language-smali">invoke-virtual <span class="token punctuation">&#123;</span><span class="token register variable">v0</span><span class="token punctuation">,</span> <span class="token register variable">v1</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token class-name"><span class="token builtin">L</span><span class="token namespace">java<span class="token punctuation">/</span>lang<span class="token punctuation">/</span></span><span class="token class-name">Object</span></span><span class="token punctuation">;</span><span class="token operator">-></span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token class-name"><span class="token builtin">L</span><span class="token namespace">java<span class="token punctuation">/</span>lang<span class="token punctuation">/</span></span><span class="token class-name">Object</span></span><span class="token punctuation">;</span><span class="token punctuation">)</span><span class="token builtin">Z</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>表面上看是调用<code>Object的equals</code>方法，但是由于obj实际上是字符串“123”，而字符串类String中<code>重写了equals方法</code>，所以虚拟机最后调用的是<code>String的equals</code>方法</p><h4 id="直接调用方法">直接调用方法</h4><p>由于调用虚方法时，虚拟机需要先查找该方法是否被重写，而对于那些无法被重写的方法，查找显得是在浪费时间，所以使用<code>invoke-direct</code>指令来<code>提高效率</code>，其通常用于<code>final方法</code>、<code>private方法</code>、<code>构造方法</code></p><h4 id="调用静态方法">调用静态方法</h4><p>这个没什么好说的，调用<code>static方法</code>时，就使用<code>invoke-static</code></p><h4 id="调用父类方法">调用父类方法</h4><p>在子类中，如果它已经<code>重写</code>了父类的XX方法，而又<code>想调用</code>父类的XX方法时，可通过<code>super.XX()</code>来调用，其对于的指令就是<code>invoke-super</code></p><h4 id="调用接口方法">调用接口方法</h4><p>这个很好理解，<code>invoke-xxxxxx &#123;参数列表&#125;, 类名-&gt;方法名(参数类型)返回类型</code>，如果类名对应的<code>类是个接口</code>，那么xxxxxx就得写<code>interface</code></p><h4 id="补充">补充</h4><p>上面的5条指令都有对应的<code>range扩展指令</code>，也就是：<code>invoke-virtual/range</code>、<code>invoke-direct/range</code>等</p><p>使用语法是：<code>invoke-xxxxxx/range &#123;vN...vM&#125;, 类名-&gt;方法名(参数类型)返回类型</code>，其中<code>N小于M</code></p><p>其等价于：<code>invoke-xxxxxx&#123;vN, vN+1,vN+2, ..., vM-2, vM-1, vM&#125;, 类名-&gt;方法名(参数类型)返回类型</code>，其中<code>N小于M</code><br>一般只会对<code>拥有很多个参数</code>的方法使用range指令，来<code>减少</code>生成的<code>代码体积</code>以及<code>提高运行效率</code></p><h3 id="更多语法">更多语法</h3><p>以上只是初步的介绍了Smali基础语法，然而实际的Smali中还有许多其它的指令，例如<code>空指令</code>、<code>数据定义指令</code>、<code>数据移动指令</code>、<code>数据转换指令</code>、<code>数学运算指令</code>、<code>数组操作指令</code>、<code>实例操作指令</code>、<code>字段操作指令</code>、<code>比较指令</code>、<code>跳转指令</code>、<code>锁指令</code>、<code>异常指令</code>、<code>返回指令</code>等等。</p><p>当然，我们可能平时用Smali的时候并不多，因此粗略的了解一下便可以了，更多语法可参考下面的文档：<br><a target="_blank" rel="noopener external nofollow noreferrer" href="https://ctf-wiki.org/android/basic_operating_mechanism/java_layer/smali/smali/">https://ctf-wiki.org/android/basic_operating_mechanism/java_layer/smali/smali/</a></p></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="https://www.overlooked.top">XiaoJun</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="https://www.overlooked.top/post/d807e443.html">https://www.overlooked.top/post/d807e443.html</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" rel="external nofollow noreferrer" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://www.overlooked.top" target="_blank">XiaoJun的个人笔记</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/Smali/">Smali</a><a class="post-meta__tags" href="/tags/Android/">Android</a><a class="post-meta__tags" href="/tags/%E9%80%86%E5%90%91/">逆向</a></div><div class="post_share"><div class="social-share" data-image="https://image.overlooked.top/img/cover/4.png" data-sites="qq,wechat,weibo"></div><link rel="stylesheet" href="https://lib.baomitu.com/butterfly-extsrc/1.1.3/sharejs/dist/css/share.min.css" media="print" onload='this.media="all"'><script src="https://lib.baomitu.com/butterfly-extsrc/1.1.3/sharejs/dist/js/social-share.min.js" defer></script></div></div><div class="post-reward"><div class="reward-button"><i class="fas fa-qrcode"></i> 打赏</div><div class="reward-main"><ul class="reward-all"><li class="reward-item"><a href="/img/reward-wechat.jpg" target="_blank"><img class="post-qr-code-img" src="/img/reward-wechat.jpg" alt="微信"></a><div class="post-qr-code-desc">微信</div></li><li class="reward-item"><a href="/img/reward-alipay.jpg" target="_blank"><img class="post-qr-code-img" src="/img/reward-alipay.jpg" alt="支付宝"></a><div class="post-qr-code-desc">支付宝</div></li></ul></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/post/963f24df.html"><img class="prev-cover" src="https://image.overlooked.top/img/cover/3.png" onerror='onerror=null,src="/img/404.jpg"' alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">Android基础之apk的组成</div></div></a></div><div class="next-post pull-right"><a href="/post/eafee158.html"><img class="next-cover" src="https://image.overlooked.top/img/cover/5.png" onerror='onerror=null,src="/img/404.jpg"' alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">Java基础---基本数据类型</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><div><a href="/post/963f24df.html" title="Android基础之apk的组成"><img class="cover" src="https://image.overlooked.top/img/cover/3.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-11-17</div><div class="title">Android基础之apk的组成</div></div></a></div></div></div><hr><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div></div><div class="comment-wrap"><div><div id="twikoo-wrap"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="/img/favicon.png" onerror='this.onerror=null,this.src="/img/friend_404.gif"' alt="avatar"></div><div class="author-info__name">XiaoJun</div><div class="author-info__description">生活本不易，且行且珍惜</div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">18</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">13</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">6</div></a></div><div class="card-info-social-icons is-center"><a class="social-icon" href="http://wpa.qq.com/msgrd?v=3&amp;uin=1520559187&amp;site=qq&amp;menu=yes" rel="external nofollow noreferrer" target="_blank" title="QQ"><i class="fab fa-qq"></i></a><a class="social-icon" href="/img/wechat.jpg" target="_blank" title="WeChat"><i class="fab fa-weixin"></i></a><a class="social-icon" href="https://github.com/OverlookedXiao" rel="external nofollow noreferrer" target="_blank" title="Github"><i class="fab fa-github"></i></a><a class="social-icon" href="mailto:1520559187@qq.com" rel="external nofollow noreferrer" target="_blank" title="Email"><i class="fas fa-envelope"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">欢迎来到XiaoJun的个人笔记 , 如果喜欢记得收藏奥～～～</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content is-expand"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#Android%E5%9F%BA%E7%A1%80%E4%B9%8BSmali%E8%AF%AD%E6%B3%95"><span class="toc-number">1.</span> <span class="toc-text">Android基础之Smali语法</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%89%8D%E8%A8%80"><span class="toc-number">1.1.</span> <span class="toc-text">前言</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%BA%E4%BB%80%E4%B9%88%E8%A6%81%E4%BA%86%E8%A7%A3Smali"><span class="toc-number">1.2.</span> <span class="toc-text">为什么要了解Smali</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Smali%E7%AE%80%E5%8D%95%E5%85%A5%E9%97%A8"><span class="toc-number">1.3.</span> <span class="toc-text">Smali简单入门</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Smali%E5%9F%BA%E6%9C%AC%E7%BB%93%E6%9E%84"><span class="toc-number">1.4.</span> <span class="toc-text">Smali基本结构</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Smali%E5%8F%98%E9%87%8F%E7%B1%BB%E5%9E%8B"><span class="toc-number">1.5.</span> <span class="toc-text">Smali变量类型</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%B0%83%E7%94%A8%E6%96%B9%E6%B3%95"><span class="toc-number">1.6.</span> <span class="toc-text">调用方法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BC%95%E7%94%A8%E5%AD%97%E6%AE%B5"><span class="toc-number">1.7.</span> <span class="toc-text">引用字段</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AF%84%E5%AD%98%E5%99%A8"><span class="toc-number">1.8.</span> <span class="toc-text">寄存器</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%99%AE%E9%80%9A%E5%AF%84%E5%AD%98%E5%99%A8"><span class="toc-number">1.8.1.</span> <span class="toc-text">普通寄存器</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8F%82%E6%95%B0%E5%AF%84%E5%AD%98%E5%99%A8"><span class="toc-number">1.8.2.</span> <span class="toc-text">参数寄存器</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%9A%90%E8%97%8F%E5%8F%82%E6%95%B0"><span class="toc-number">1.8.3.</span> <span class="toc-text">隐藏参数</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%B0%83%E7%94%A8%E6%96%B9%E6%B3%95%E7%9A%84%E6%8C%87%E4%BB%A4"><span class="toc-number">1.9.</span> <span class="toc-text">调用方法的指令</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%B0%83%E7%94%A8%E8%99%9A%E6%96%B9%E6%B3%95"><span class="toc-number">1.9.1.</span> <span class="toc-text">调用虚方法</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%9B%B4%E6%8E%A5%E8%B0%83%E7%94%A8%E6%96%B9%E6%B3%95"><span class="toc-number">1.9.2.</span> <span class="toc-text">直接调用方法</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%B0%83%E7%94%A8%E9%9D%99%E6%80%81%E6%96%B9%E6%B3%95"><span class="toc-number">1.9.3.</span> <span class="toc-text">调用静态方法</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%B0%83%E7%94%A8%E7%88%B6%E7%B1%BB%E6%96%B9%E6%B3%95"><span class="toc-number">1.9.4.</span> <span class="toc-text">调用父类方法</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%B0%83%E7%94%A8%E6%8E%A5%E5%8F%A3%E6%96%B9%E6%B3%95"><span class="toc-number">1.9.5.</span> <span class="toc-text">调用接口方法</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%A1%A5%E5%85%85"><span class="toc-number">1.9.6.</span> <span class="toc-text">补充</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9B%B4%E5%A4%9A%E8%AF%AD%E6%B3%95"><span class="toc-number">1.10.</span> <span class="toc-text">更多语法</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/post/3df782a1.html" title="DRSSTC教程 第五章 - DRSSTC的功率电路设计"><img src="https://image.overlooked.top/img/cover/18.png" onerror='this.onerror=null,this.src="/img/404.jpg"' alt="DRSSTC教程 第五章 - DRSSTC的功率电路设计"></a><div class="content"><a class="title" href="/post/3df782a1.html" title="DRSSTC教程 第五章 - DRSSTC的功率电路设计">DRSSTC教程 第五章 - DRSSTC的功率电路设计</a><time datetime="2023-06-05T11:23:27.000Z" title="发表于 2023-06-05 19:23:27">2023-06-05</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/post/11ad15b.html" title="DRSSTC教程 第四章 - DRSSTC的驱动电路原理"><img src="https://image.overlooked.top/img/cover/17.png" onerror='this.onerror=null,this.src="/img/404.jpg"' alt="DRSSTC教程 第四章 - DRSSTC的驱动电路原理"></a><div class="content"><a class="title" href="/post/11ad15b.html" title="DRSSTC教程 第四章 - DRSSTC的驱动电路原理">DRSSTC教程 第四章 - DRSSTC的驱动电路原理</a><time datetime="2023-06-05T08:24:35.000Z" title="发表于 2023-06-05 16:24:35">2023-06-05</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/post/3a404290.html" title="DRSSTC教程 第三章 - 特斯拉线圈的灭弧电路设计"><img src="https://image.overlooked.top/img/cover/16.png" onerror='this.onerror=null,this.src="/img/404.jpg"' alt="DRSSTC教程 第三章 - 特斯拉线圈的灭弧电路设计"></a><div class="content"><a class="title" href="/post/3a404290.html" title="DRSSTC教程 第三章 - 特斯拉线圈的灭弧电路设计">DRSSTC教程 第三章 - 特斯拉线圈的灭弧电路设计</a><time datetime="2023-06-05T04:17:10.000Z" title="发表于 2023-06-05 12:17:10">2023-06-05</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/post/bb8c4a88.html" title="DRSSTC教程 第二章 - 特斯拉线圈的原理分析"><img src="https://image.overlooked.top/img/cover/15.png" onerror='this.onerror=null,this.src="/img/404.jpg"' alt="DRSSTC教程 第二章 - 特斯拉线圈的原理分析"></a><div class="content"><a class="title" href="/post/bb8c4a88.html" title="DRSSTC教程 第二章 - 特斯拉线圈的原理分析">DRSSTC教程 第二章 - 特斯拉线圈的原理分析</a><time datetime="2023-01-09T03:18:34.000Z" title="发表于 2023-01-09 11:18:34">2023-01-09</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/post/f40ed205.html" title="DRSSTC教程 第一章 - 特斯拉线圈的分类和欣赏"><img src="https://image.overlooked.top/img/cover/14.png" onerror='this.onerror=null,this.src="/img/404.jpg"' alt="DRSSTC教程 第一章 - 特斯拉线圈的分类和欣赏"></a><div class="content"><a class="title" href="/post/f40ed205.html" title="DRSSTC教程 第一章 - 特斯拉线圈的分类和欣赏">DRSSTC教程 第一章 - 特斯拉线圈的分类和欣赏</a><time datetime="2023-01-07T10:42:12.000Z" title="发表于 2023-01-07 18:42:12">2023-01-07</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2024 By XiaoJun</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener external nofollow noreferrer" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener external nofollow noreferrer" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div><div class="footer_custom_text">Hi , welcome to my <a href="https://www.overlooked.top">blog</a>!</div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button></div><div id="rightside-config-show"><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span> 数据库加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章"></div></div><hr><div id="local-search-results"></div></div></div><div id="search-mask"></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://lib.baomitu.com/fancyapps-ui/4.0.31/fancybox.umd.min.js"></script><script src="https://lf3-cdn-tos.bytecdntp.com/cdn/expire-1-M/instant.page/5.1.0/instantpage.min.js" type="module"></script><script>function panguFn(){"object"==typeof pangu?pangu.autoSpacingPage():getScript("https://lib.baomitu.com/pangu/4.0.7/pangu.min.js").then((()=>{pangu.autoSpacingPage()}))}function panguInit(){panguFn()}document.addEventListener("DOMContentLoaded",panguInit)</script><script src="/js/search/local-search.js"></script><div class="js-pjax"><script>(()=>{const o=()=>{twikoo.init(Object.assign({el:"#twikoo-wrap",envId:"https://twikoo.overlooked.top/",region:"",onCommentLoaded:function(){btf.loadLightbox(document.querySelectorAll("#twikoo .tk-content img:not(.tk-owo-emotion)"))}},null)),GLOBAL_CONFIG_SITE.isPost&&(()=>{const o=document.getElementById("twikoo-count");o&&twikoo.getCommentsCount({envId:"https://twikoo.overlooked.top/",region:"",urls:[window.location.pathname],includeReply:!1}).then((function(t){o.innerText=t[0].count})).catch((function(o){console.error(o)}))})()},t=()=>{"object"!=typeof twikoo?getScript("https://lib.baomitu.com/twikoo/1.6.7/twikoo.all.min.js").then(o):setTimeout(o,0)};t()})()</script></div><script src="/js/marge.js"></script><script src="/hijiki/live2d.js" defer async></script><canvas class="fireworks" mobile="true"></canvas><script src="https://lib.baomitu.com/butterfly-extsrc/1.1.3/fireworks.min.js"></script><script defer id="fluttering_ribbon" mobile="true" src="https://lib.baomitu.com/butterfly-extsrc/1.1.3/canvas-fluttering-ribbon.min.js"></script><script async data-pjax src="//npm.elemecdn.com/penndu@1.0.0/bsz.js"></script></div></body></html>